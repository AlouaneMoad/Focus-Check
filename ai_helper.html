<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mindful AI Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg-primary: url("background.webp");
            --bg-secondary: rgba(20, 26, 41, 0.75); 
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-primary: #475569;
            --accent-primary: #8b5cf6; /* Violet */
            --accent-hover: #7c3aed;
        }

        body {
            background-image: var(--bg-primary);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: "Inter", sans-serif;
            color: var(--text-primary);
            overflow: hidden;
        }
        
        #loading-screen { 
            background-image: url('loading.webp');
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease;
        }
        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .exit-btn {
            display: flex; align-items: center; gap: 0.5rem; background-color: var(--bg-secondary);
            padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 600;
            border: 1px solid var(--border-primary); transition: all 0.2s ease-in-out;
            text-decoration: none; color: var(--text-primary);
        }
        .exit-btn:hover { background-color: #334155; transform: scale(1.05); }
        
        .main-container, .modal-card {
            background-color: var(--bg-secondary);
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border-primary); border-radius: 1.5rem;
            padding: 2rem; width: 100%; max-width: 800px;
        }

        .main-container { height: 85vh; display: flex; flex-direction: column; }
        .chat-window { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; }

        .message-bubble { padding: 0.75rem 1.25rem; border-radius: 1.25rem; max-width: 85%; line-height: 1.6; }
        .message-bubble.user {
            background-color: var(--accent-primary); color: white;
            border-bottom-right-radius: 0.25rem; align-self: flex-end;
        }
        .message-bubble.ai {
            background-color: #334155; border-bottom-left-radius: 0.25rem; align-self: flex-start;
        }
        .message-bubble.ai.typing {
            color: var(--text-secondary); font-style: italic;
        }
        .message-bubble.system {
            background-color: transparent; border: 2px dashed var(--border-primary); color: var(--text-secondary);
            font-size: 0.875rem; align-self: center; text-align: center; max-width: 100%;
        }

        #chat-input { background-color: #334155; border: 1px solid var(--border-primary); }
        #chat-input:focus { border-color: var(--accent-primary); box-shadow: none; outline: none; }
        
        #send-btn { background-color: var(--accent-primary); }
        #send-btn:hover { background-color: var(--accent-hover); }
        #send-btn:disabled { background-color: #475569; cursor: not-allowed; }

        /* Scrollbar */
        .chat-window::-webkit-scrollbar { width: 8px; }
        .chat-window::-webkit-scrollbar-track { background: transparent; }
        .chat-window::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .chat-window::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center">
        <div class="text-center">
            <img src="icon.png" alt="Loading Icon" class="w-20 h-20 mx-auto mb-4 animate-bounce">
            <p class="text-lg font-semibold">Loading AI Helper...</p>
        </div>
    </div>

    <div id="api-key-modal" class="hidden fixed inset-0 z-40 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
        <div class="modal-card text-center max-w-md">
            <i class="fa-solid fa-key text-4xl text-[var(--accent-primary)] mb-4"></i>
            <h1 class="text-2xl font-bold mb-2">Enter Your API Key</h1>
            <p class="text-slate-300 mb-6 text-sm">To use the AI Helper, please provide your API key from <a href="https://openrouter.ai/" target="_blank" class="font-semibold text-[var(--accent-primary)] hover:underline">OpenRouter.ai</a>. Your key is saved securely in your browser and never sent anywhere else.</p>
            <input type="password" id="api-key-input" placeholder="sk-or-..." class="w-full px-4 py-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:border-[var(--accent-primary)] mb-4">
            <button id="save-key-btn" class="w-full px-6 py-3 font-semibold text-white rounded-lg bg-[var(--accent-primary)] hover:bg-[var(--accent-hover)] transition-colors duration-300">Save and Start Chatting</button>
        </div>
    </div>

    <header class="absolute top-8 left-8 z-30">
        <a href="index.html" class="exit-btn">
            <i class="fa-solid fa-arrow-left"></i>
            <span>Exit</span>
        </a>
    </header>

    <main id="app-wrapper" class="hidden main-container">
        <div id="chat-window" class="chat-window p-2">
             <div class="message-bubble system">
                <p><i class="fa-solid fa-brain mr-2"></i>You are chatting with <strong>Mindful AI</strong>. Ask for advice on digital wellness, managing screen time, or handling online stress.</p>
            </div>
        </div>
        <div class="mt-4 pt-4 border-t border-[var(--border-primary)]">
            <form id="chat-form" class="flex items-center gap-3">
                <input type="text" id="chat-input" class="flex-grow w-full px-4 py-3 rounded-lg text-white placeholder-slate-400" placeholder="Ask for advice..." autocomplete="off">
                <button type="submit" id="send-btn" class="flex-shrink-0 w-12 h-12 rounded-full font-semibold text-white transition-colors duration-300 flex items-center justify-center">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
                 <button type="button" id="clear-btn" title="Clear Conversation" class="flex-shrink-0 w-12 h-12 rounded-full font-semibold text-white bg-slate-600 hover:bg-slate-700 transition-colors duration-300 flex items-center justify-center">
                    <i class="fa-solid fa-eraser"></i>
                </button>
            </form>
        </div>
    </main>
    
    <script>
    (function () {
        const CLICK_SOUND_SRC = 'click.mp3'; 
        function playClickSound() {
            try {
                const audio = new Audio(CLICK_SOUND_SRC);
                audio.play().catch(err => {});
            } catch (err) {}
        }

        document.body.addEventListener('click', function (e) {
            const actionable = e.target.closest('button, a.exit-btn');
            if (!actionable || actionable.disabled) return;
            playClickSound();
        });
    })();
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const OPENROUTER_API_URL = 'https://openrouter.ai/api/v1/chat/completions';
            const AI_MODEL = 'deepseek/deepseek-chat';

            // --- DOM ELEMENTS ---
            const loadingScreen = document.getElementById('loading-screen');
            const apiKeyModal = document.getElementById('api-key-modal');
            const apiKeyInput = document.getElementById('api-key-input');
            const saveKeyBtn = document.getElementById('save-key-btn');
            const appWrapper = document.getElementById('app-wrapper');
            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            const clearBtn = document.getElementById('clear-btn');

            let apiKey = localStorage.getItem('openRouterApiKey');
            let conversationHistory = [];

            // --- FUNCTIONS ---
            function renderMessage(sender, text) {
                const messageEl = document.createElement('div');
                messageEl.className = `message-bubble ${sender}`;
                messageEl.textContent = text;
                chatWindow.appendChild(messageEl);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return messageEl;
            }

            function initializeChat() {
                chatWindow.innerHTML = `
                    <div class="message-bubble system">
                        <p><i class="fa-solid fa-brain mr-2"></i>You are chatting with <strong>Mindful AI</strong>. Ask for advice on digital wellness, managing screen time, or handling online stress.</p>
                    </div>`;
                conversationHistory = [{
                    role: 'system',
                    content: "You are Mindful-AI, an AI-powered digital health advisory assistant that provides emotional support and objective, accurate information. Your target audience is students experiencing social media distress. Focusing on social media usage time, digital information overload, and potential health risks, you will provide specific, actionable, calm, practical, and encouraging online advice. Please avoid providing medical advice. Keep your responses concise and understandable."
                }];
            }

            async function handleChatSubmit(e) {
                e.preventDefault();
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;

                renderMessage('user', userMessage);
                conversationHistory.push({ role: 'user', content: userMessage });
                chatInput.value = '';
                sendBtn.disabled = true;

                const typingIndicator = renderMessage('ai typing', '...');

                try {
                    const response = await fetch(OPENROUTER_API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: AI_MODEL,
                            messages: conversationHistory
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const data = await response.json();
                    const aiMessage = data.choices[0].message.content;
                    
                    typingIndicator.textContent = aiMessage;
                    typingIndicator.classList.remove('typing');
                    conversationHistory.push({ role: 'assistant', content: aiMessage });

                } catch (error) {
                    typingIndicator.textContent = 'Sorry, something went wrong. Please check your API key or try again.';
                    typingIndicator.classList.add('error');
                    console.error('API call failed:', error);
                } finally {
                    sendBtn.disabled = false;
                    chatInput.focus();
                }
            }
            
            function saveApiKey() {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem('openRouterApiKey', key);
                    apiKey = key;
                    apiKeyModal.classList.add('hidden');
                    appWrapper.classList.remove('hidden');
                    initializeChat();
                }
            }

            // --- INITIALIZATION & EVENT LISTENERS ---
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    if (!apiKey) {
                        apiKeyModal.classList.remove('hidden');
                    } else {
                        appWrapper.classList.remove('hidden');
                        initializeChat();
                    }
                }, 500);
            }, 1500);

            saveKeyBtn.addEventListener('click', saveApiKey);
            apiKeyInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') saveApiKey(); });
            chatForm.addEventListener('submit', handleChatSubmit);
            clearBtn.addEventListener('click', initializeChat);
        });
    </script>
</body>
</html>